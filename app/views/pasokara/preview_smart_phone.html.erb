<div data-role="page" data-theme="a" id="pasokara-preview-<%= @pasokara.id.to_s %>">
  <%= javascript_include_tag("throbberA.js") %>
  <script>
    var throbber;
    function throbber_init() {
      throbber = new ThrobberA({size: 64});
      throbber.show(document.getElementById("throbber"));
    }

    function add_video_tag(id, path) {
      var video = $("<video>").attr("id", "video-" + id).attr("width", 480).attr("height", 320).attr("controls", "controls").attr("src", path);
      $("#jqm-video").append(video);
    }

    function check_m3u8(id, path, count) {
      count = count + 1;
      if (count > 10) {
        alert("Video Loading Failed");
        return false;
      }
      $.ajax({
        type: "HEAD",
        url: path,
        success: function(){
          add_video_tag(id, path);
          throbber.hide();
        },
        error: function(){
          setTimeout(function(){check_m3u8(id, path, count)}, 3000);
        }
      })
    }

    $("#pasokara-preview-<%= @pasokara.id.to_s %>").pagecreate(function() {
      throbber_init();
      check_m3u8(<%= @pasokara.id %>, "<%= @movie_path %>", 0);
    });
  </script>
  <div data-role="header">
    <a href="#" data-rel="back" data-icon="back">Back</a>
    <h1><%= @pasokara.name %></h1>
    <a href="#search" data-icon="search" data-transition="slidedown" class="ui-btn-right">Search</a>
    <%= jqm_nav_bar %>
  </div>

  <div data-role="content">
    <h3><%= h @pasokara.name %></h3>
    <span id="throbber"></span>
    <div id="video"></div>
    <%= link_to "強制エンコード", {:id => @pasokara.id, :force => true}, "data-role".to_sym => "button", "data-theme".to_sym => "c" %>
  </div>
</div>

<%= jqm_search_page %>
